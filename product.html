<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Товар — Просмотр</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="page">
<header class="header">
    <a href="index.html" class="back-link">← На главную</a>
    <a href="cart.html" target="_blank" class="cart-button">Корзина</a>
</header>

<main class="main main-product">
    <section class="product-detail">
        <div class="product-detail-images">
            <div class="product-detail-main">
                <img id="mainImage" src="" alt="Товар" class="product-detail-main-img">
            </div>
            <div class="product-detail-gallery" id="gallery">
                <!-- СЮДА JS ДОБАВИТ МНОГО ФОТО, БУДЕТ ГОРИЗОНТАЛЬНЫЙ СКРОЛЛ -->
            </div>
        </div>
        <div class="product-detail-info">
            <h1 id="productName" class="product-detail-title"></h1>
            <p id="productPrice" class="product-detail-price"></p>
            <p id="productDescription" class="product-detail-description"></p>
            <button id="orderButton" class="primary-button">
                Заказать
            </button>
            <p class="product-detail-note">
                Выбранные товары сохраняются в корзине даже после закрытия сайта
                (используем <strong>localStorage</strong> как надёжный safeguard).
            </p>
        </div>
    </section>
</main>

<script src="products.js"></script>
<script>
    // Берём id товара из адресной строки, например product.html?id=1
    const params = new URLSearchParams(window.location.search);
    const productId = parseInt(params.get('id'), 10);

    const product = getProductById(productId) || getProducts()[0];

    const mainImageEl = document.getElementById('mainImage');
    const galleryEl = document.getElementById('gallery');
    const nameEl = document.getElementById('productName');
    const priceEl = document.getElementById('productPrice');
    const descEl = document.getElementById('productDescription');
    const orderButton = document.getElementById('orderButton');

    if (product) {
        nameEl.textContent = product.name;
        priceEl.textContent = product.price + ' ₽';
        descEl.textContent = product.description;

        // Главное фото
        mainImageEl.src = product.images[0];

        // Галерея с горизонтальным скроллом
        product.images.forEach((imgUrl) => {
            const img = document.createElement('img');
            img.src = imgUrl;
            img.alt = product.name;
            img.className = 'product-detail-thumb';
            img.addEventListener('click', () => {
                mainImageEl.src = imgUrl;
            });
            galleryEl.appendChild(img);
        });
    }

    function loadCart() {
        try {
            return JSON.parse(localStorage.getItem('cartItems')) || [];
        } catch (e) {
            return [];
        }
    }

    function saveCart(cart) {
        localStorage.setItem('cartItems', JSON.stringify(cart));
    }

    function addToCart(item) {
        const cart = loadCart();
        const existing = cart.find(c => c.id === item.id);
        if (existing) {
            existing.quantity += 1;
        } else {
            cart.push({
                id: item.id,
                name: item.name,
                price: item.price,
                quantity: 1
            });
        }
        saveCart(cart);
    }

    orderButton.addEventListener('click', () => {
        addToCart({
            id: product.id,
            name: product.name,
            price: product.price
        });

        orderButton.textContent = 'Добавлено в корзину';
        orderButton.classList.add('primary-button-success');

        setTimeout(() => {
            orderButton.textContent = 'Заказать';
            orderButton.classList.remove('primary-button-success');
        }, 1500);
    });
</script>
</body>
</html>
